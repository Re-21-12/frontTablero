<div class="container mt-5 text-light shadow-lg">
  <h2 class="mb-4 text-gradient">Gestor de Correos</h2>

  <!-- ============================
       FORMULARIO NUEVO CORREO
  ============================ -->
  <div class="card bg-section mb-5 p-4">
    <h5 class="mb-3 text-accent">Enviar nuevo correo</h5>

    <form (submit)="sendEmail()">
      <div class="row g-3">
        <div class="col-md-6">
          <label>Para:</label>
          <input
            [(ngModel)]="form.to"
            name="to"
            type="email"
            class="form-control"
            placeholder="correo@dominio.com"
            required
          />
        </div>

        <div class="col-md-6">
          <label>Asunto:</label>
          <input
            [(ngModel)]="form.subject"
            name="subject"
            class="form-control"
            placeholder="Asunto del mensaje"
            required
          />
        </div>

        <div class="col-12">
          <label>Cuerpo:</label>
          <textarea
            [(ngModel)]="form.body"
            name="body"
            rows="4"
            class="form-control"
            placeholder="Contenido del correo (HTML o texto plano)"
            required
          ></textarea>
        </div>
      </div>

      <div class="mt-3 text-end">
        <button type="submit" class="btn btn-primary px-4">
          <i class="bi bi-send"></i> Enviar
        </button>
      </div>
    </form>
  </div>

  <!-- ============================
       LISTADO DE CORREOS
  ============================ -->
  <div class="card bg-section mb-5 p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="text-accent">Correos enviados</h5>
      <div *ngIf="loading" class="spinner-border text-info" role="status"></div>
    </div>

    <div *ngIf="!loading && emails.length > 0" class="table-responsive">
      <table class="table table-dark table-striped align-middle text-sm">
        <thead>
          <tr>
            <th>ID</th>
            <th>Para</th>
            <th>Asunto</th>
            <th>Estado</th>
            <th>Creado</th>
            <th>Enviado</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let e of emails">
            <td>{{ e.id }}</td>
            <td>{{ e.to }}</td>
            <td>{{ e.subject }}</td>
            <td><span class="badge bg-status">{{ e.status || 'Pendiente' }}</span></td>
            <td>{{ e.created_at | date: 'short' }}</td>
            <td>{{ e.sent_at | date: 'short' }}</td>
            <td class="text-center">
              <button
                type="button"
                class="btn btn-sm btn-outline-danger"
                (click)="deleteEmail(e.id)"
              >
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="!loading && emails.length === 0" class="alert alert-secondary mt-3">
      No hay correos para mostrar.
    </div>

    <!-- Paginación -->
    <div class="d-flex justify-content-between align-items-center mt-3">
      <button
        class="btn btn-outline-light"
        (click)="changePage(false)"
        [disabled]="page === 1"
      >
        ⏮ Anterior
      </button>

      <span class="fw-semibold text-muted">Página {{ page }} de {{ totalPages }}</span>

      <button
        class="btn btn-outline-light"
        (click)="changePage(true)"
        [disabled]="page >= totalPages"
      >
        Siguiente ⏭
      </button>
    </div>
  </div>

  <!-- ============================
       CREAR PLANTILLA
  ============================ -->
  <div class="card bg-section mb-5 p-4">
    <h5 class="mb-3 text-accent">Crear nueva plantilla</h5>

    <form (submit)="createTemplate()">
      <div class="row g-3">
        <div class="col-md-6">
          <label>Nombre:</label>
          <input
            [(ngModel)]="templateForm.name"
            name="name"
            class="form-control"
            placeholder="Ejemplo: Bienvenida"
            required
          />
        </div>

        <div class="col-md-6">
          <label>Asunto:</label>
          <input
            [(ngModel)]="templateForm.subject"
            name="subject"
            class="form-control"
            placeholder="Asunto del correo"
            required
          />
        </div>

        <div class="col-12">
          <label>Cuerpo:</label>
          <textarea
            [(ngModel)]="templateForm.body"
            name="body"
            rows="4"
            class="form-control"
            placeholder="HTML o texto plano"
            required
          ></textarea>
        </div>
      </div>

      <div class="mt-3 text-end">
        <button type="submit" class="btn btn-success px-4">
          <i class="bi bi-file-earmark-plus"></i> Crear plantilla
        </button>
      </div>
    </form>

    <div *ngIf="templateMsg" class="alert alert-info mt-3 text-center">
      {{ templateMsg }}
    </div>
  </div>

  <!-- ============================
       ACTUALIZAR PLANTILLA
  ============================ -->
  <div class="card bg-section p-4">
    <h5 class="mb-3 text-accent">Actualizar plantilla existente</h5>

    <form (submit)="updateTemplate()">
      <div class="row g-3">
        <div class="col-md-4">
          <label>ID de la plantilla:</label>
          <input
            [(ngModel)]="templateForm.id"
            name="id"
            type="number"
            class="form-control"
            placeholder="Ejemplo: 1"
            required
          />
        </div>

        <div class="col-md-4">
          <label>Nuevo asunto:</label>
          <input
            [(ngModel)]="templateForm.subject"
            name="subject"
            class="form-control"
            placeholder="Asunto del correo"
            required
          />
        </div>

        <div class="col-12">
          <label>Nuevo cuerpo (HTML o texto):</label>
          <textarea
            [(ngModel)]="templateForm.body"
            name="body"
            rows="4"
            class="form-control"
            placeholder="Nuevo contenido"
            required
          ></textarea>
        </div>
      </div>

      <div class="mt-3 text-end">
        <button type="submit" class="btn btn-warning px-4">
          <i class="bi bi-arrow-repeat"></i> Actualizar plantilla
        </button>
      </div>
    </form>

    <div *ngIf="templateUpdateMsg" class="alert alert-info mt-3 text-center">
      {{ templateUpdateMsg }}
    </div>
  </div>
</div>
