<section class="panel">
  <header class="panel__header">
    <h2 class="panel__title">Partidos</h2>
  </header>

  <div class="toolbar toolbar--wrap">
    <div class="field">
      <label class="label">Fecha y hora</label>
      <input class="input" type="datetime-local" [(ngModel)]="fechaHoraLocal" />
    </div>

    <div class="field">
      <label class="label">Localidad</label>
      <select class="input" [(ngModel)]="partLocalidadId">
        <option [ngValue]="null">Seleccionar</option>
        <option *ngFor="let l of localidades()" [ngValue]="l.id">{{ l.nombre }}</option>
      </select>
    </div>

    <div class="field">
      <label class="label">Equipo Local</label>
      <select class="input" [(ngModel)]="equipoLocal">
        <option [ngValue]="null">Seleccionar</option>
        <option *ngFor="let e of equipos()" [ngValue]="e">{{ e.nombre }}</option>
      </select>
    </div>

    <div class="field">
      <label class="label">Equipo Visitante</label>
      <select class="input" [(ngModel)]="equipoVisitante">
        <option [ngValue]="null">Seleccionar</option>
        <option *ngFor="let e of equipos()" [ngValue]="e">{{ e.nombre }}</option>
      </select>
    </div>

    <div class="field field--actions">
      <label class="label">&nbsp;</label>
      <button class="btn"
              (click)="crearPartido()"
              [disabled]="!fechaHoraLocal || !partLocalidadId() || !equipoLocal() || !equipoVisitante()">
        Crear partido
      </button>
    </div>
  </div>

  <small class="form-hint error"
         *ngIf="equipoLocal() && equipoVisitante() && equipoLocal()?.id_Equipo === equipoVisitante()?.id_Equipo">
    El equipo local y visitante no pueden ser el mismo.
  </small>

  <div class="list-scroll">
    <ul class="list match-list">
      <li class="row-item match-card"
          *ngFor="let p of items(); let i = index; trackBy: trackByPartido">
        <div class="match-date">
          <span class="pill pill--date">{{ p.fechaHora }}</span>
          <span class="pill pill--loc">{{ nombreLocalidad(p.id_Localidad) }}</span>
        </div>

        <div class="match-body">
          <div class="team">
            <ng-container *ngIf="logoEquipo(p.local) as logo; else noLogoLocal">
              <img class="crest-img" [src]="logo" (error)="onImgErr($event)" alt="logo local" />
            </ng-container>
            <ng-template #noLogoLocal>N/A</ng-template>
            <span class="team-name">{{ p.local }}</span>
          </div>

          <div class="vs">VS</div>

          <div class="team">
            <ng-container *ngIf="logoEquipo(p.visitante) as logo; else noLogoVisitante">
              <img class="crest-img crest--away" [src]="logo" (error)="onImgErr($event)" alt="logo visitante" />
            </ng-container>
            <ng-template #noLogoVisitante>N/A</ng-template>
            <span class="team-name">{{ p.visitante }}</span>
          </div>
        </div>

        <div class="match-actions">
          <button class="btn btn--ghost" (click)="editarTablero(i)">Editar Tablero</button>
          <button class="btn btn--ghost" (click)="editarPartido(p)">Editar</button>
          <button class="btn btn--ghost" (click)="toggleDetallesByIndex(i)">Detalles</button>
          <button class="btn" (click)="generarReporteRosterFromRow(p)">Generar Roster</button>
        </div>
        <div class="match-details" *ngIf="expandedIndex() === i">
          <div class="detail-row"><span class="dt">Fecha/Hora:</span><span class="dd">{{ p.fechaHora }}</span></div>
          <div class="detail-row"><span class="dt">Localidad:</span><span class="dd">{{ nombreLocalidad(p.id_Localidad) }}</span></div>
          <div class="detail-row"><span class="dt">Equipos:</span><span class="dd">{{ p.local }} vs {{ p.visitante }}</span></div>
        </div>
      </li>
    </ul>
  </div>

  <mat-paginator
    [length]="totalRegistros()"
    [pageSize]="tamanio"
    [pageSizeOptions]="[5, 10, 25]"
    (page)="cambiarPagina($event)">
  </mat-paginator>

</section>

